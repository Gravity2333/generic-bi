[{"id":"0da7ef2c-9e39-4e15-9595-145bd0dcbef7","name":"欢迎使用Generic BI","widget_ids":[],"specification":{"layouts":[{"w":12,"h":2,"x":0,"y":0,"i":"8aa4fc30-9d1f-11ef-8786-15af3a3045ad$__$TEXTDIVIDER","moved":false,"static":false,"isDraggable":false,"isResizable":false},{"w":5,"h":14,"x":0,"y":2,"i":"3d97fd60-9d20-11ef-8786-15af3a3045ad$__$RICHEDITOR","moved":false,"static":false,"isDraggable":false,"isResizable":false},{"w":7,"h":14,"x":5,"y":2,"i":"22fc5ae0-9d21-11ef-b7df-c1e8a834f834$__$RICHEDITOR","moved":false,"static":false,"isDraggable":false,"isResizable":false}],"texts":{"8aa4fc30-9d1f-11ef-8786-15af3a3045ad$__$TEXTDIVIDER":"欢迎使用Generic BI","3d97fd60-9d20-11ef-8786-15af3a3045ad$__$RICHEDITOR":"<h1 id=\"wdv2j\">Generic-bi-server </h1><br/>是 一个通用的bi系统,目前支持Clickhouse Postgre Mysql的数据可视化！<p><br/></p><h3 id=\"5o7hn\">安装postgre</h3>下载地址 <a href=\"https://postgresapp.com/downloads.html\" target=\"_blank\">https://postgresapp.com/downloads.html</a><br/><br/>客户端推荐: <a href=\"https://eggerapps.at/postico/v1.php\" target=\"_blank\">https://eggerapps.at/postico/v1.php</a><p><br/></p><h3 id=\"2tm6q\">创建数据库</h3>CREATE DATABASE bi;<br/><br/><h3 id=\"bqlp4\">创建用户</h3>超级管理员 postgre下：<br/>CREATE USER genericbiserver WITH PASSWORD 'genericbiserver@123';<br/><br/><h3 id=\"g8s9u\">给权限</h3>grant all on schema public to genericbiserver;<br/><br/><h3 id=\"dv9ou\">&nbsp;安装redis</h3>下载地址 <a href=\"https://redis.io/docs/latest/operate/oss_and_stack/install/install-redis\" target=\"_blank\">https://redis.io/docs/latest/operate/oss_and_stack/install/install-redis</a><br/>","22fc5ae0-9d21-11ef-b7df-c1e8a834f834$__$RICHEDITOR":"<h2 id=\"nhnrj\">使用 Docker 构建和运行 bi-server</h2><h3 id=\"vc2x4\">&nbsp;bi-builder</h3>`bi-builder`镜像用于构建`bi-server`代码，镜像中打包了`bi-server`的所有依赖，流水线构建`bi-server`代码时不再执行`npm install`下载依赖包，加速构建过程。<br/><br/>在`bi-common`, `bi-manager-web`, `bi-manager`的`package.json`中增加依赖项时，需要更新 `bi-builder` 镜像。<br/><br/>### 构建 bi-builder 镜像<br/><br/>分别在 x86_64 和 arm64v8 环境使用 `Dockerfile.builder` 镜像构建 `bi-builder` 镜像。<br/><br/>```bash<br/># x86_64<br/>docker build -t machloop/bi-builder:hj-x86_64 -f Dockerfile.builder .<br/><br/># arm64v8<br/>docker build -t machloop/bi-builder:hj-arm64v8 -f Dockerfile.builder .<br/>```<br/><br/>### 推送 bi-builder 镜像到 Harbor<br/><br/>```bash<br/># 登录 Harbor 并输入用户名密码<br/>docker login 10.0.0.110:4443<br/><br/># x86_64<br/>docker tag machloop/bi-builder:hj-x86_64 10.0.0.110:4443/machloop/bi-builder:hj-x86_64<br/>docker push 10.0.0.110:4443/machloop/bi-builder:hj-x86_64<br/><br/># arm64v8<br/>docker tag machloop/bi-builder:hj-amr64v8 10.0.0.110:4443/machloop/bi-builder:hj-arm64v8<br/>docker push 10.0.0.110:4443/machloop/bi-builder:hj-arm64v8<br/>```<br/><br/>## bi-runner<br/><br/>`bi-runner`镜像用于运行`bi-server`。镜像已添加到基础包中。安装包中只需要打包编译过的`bi-common`和`bi-server`代码，安装时将`bi-server`目录映射到`bi-runner`容器中运行。<br/><br/>在`bi-manager`的`package.json`中增加依赖项时，需要更新`bi-runner`镜像并在基础包中替换。<br/><br/>### 构建 bi-runner 镜像<br/><br/>```bash<br/># x86_64<br/>docker build -t machloop/bi-runner:hj-x86_64 -f Dockerfile.runner .<br/><br/># arm64v8<br/>docker build -t machloop/bi-runner:hj-arm64v8 -f Dockerfile.runner.arm .<br/>```<br/><br/>### 推送 bi-runner 镜像到 Harbor<br/><br/>```bash<br/># x86_64<br/>docker tag machloop/bi-runner:hj-x86_64 10.0.0.110:4443/machloop/bi-runner:hj-x86_64<br/>docker push 10.0.0.110:4443/machloop/bi-runner:hj-x86_64<br/><br/># arm64v8<br/>docker tag machloop/bi-runner:hj-amr64v8 10.0.0.110:4443/machloop/bi-runner:hj-arm64v8<br/>docker push 10.0.0.110:4443/machloop/bi-runner:hj-arm64v8<br/>```<br/><br/>### 导出 bi-runner 镜像替换到基础包<br/><br/>1. 分别给 x86_64 环境和 arm64v8 环境的`bi-runner`镜像打`hj`标签。<br/><br/>```bash<br/># x86_64<br/>docker tag machloop/bi-runner:hj-x86_64 machloop/bi-runner:hj<br/><br/># arm64v8<br/>docker tag machloop/bi-runner:hj-arm64v8 machloop/bi-runner:hj<br/>```<br/><br/>2. 导出镜像tarball<br/><br/>```bash<br/>docker save machloop/bi-runner:hj | gzip &gt; bi-runner.tar.gz<br/>```<br/><br/>3. 替换基础包中的`bi-runner`镜像，镜像在基础包中的路径分别如下<br/><br/>x86_64: svn://10.0.0.110/fpc-install/branches/caps/infrastructure/es_clickhouse<br/>arm64v8: svn://10.0.0.110/infrastructure/branches/dev_tfa_npmd_aarch64/images<br/><br/>## 使用 bi-builder 镜像打包 bi-server<br/><br/>1. 检出`bi-server`代码库并切换到代码库目录。<br/><br/>```bash<br/>git clone -b HJ <a href=\"http://10.0.0.110:3000/hujingbang/bi-server.git\" target=\"_blank\">http://10.0.0.110:3000/hujingbang/bi-server.git</a><br/>cd bi-server<br/>```<br/><br/>2. 将代码库目录映射到容器，并使用脚本构建`bi-server`安装包。<br/><br/>```bash<br/>docker run -it --rm -v $(pwd):/bi-server machloop/bi-builder:hj bash /bi-server/bi-server-build.sh<br/>```<br/><br/>## 运行 bi-server<br/><br/>将生成的`bi-server`安装包`bi.tar.gz`复制到测试环境并解压到安装目录，重启`machloop-bi-server`容器运行`bi-server`。<br/><br/>```bash<br/>tar zxf bi.tar.gz -C /opt/components/bi-apps/ --strip-components=1<br/>docker restart machloop-bi-server<br/>```<br/>"}},"description":"","readonly":"1","created_at":"2024-11-07T15:47:35.159Z","updated_at":"2024-11-07T16:00:34.678Z","deleted_at":null,"widgets":[]}]